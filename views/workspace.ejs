<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=3, initial-scale=1.0">
    <title>workspace</title>
    <link rel="stylesheet" href="/css/workspace.css">
</head>
<style>
</style>

<body>
    <div id = "loader"><div class = "spinner"></div></div>
    <div id="back"></div>
    <div id="left" class="left">
        <p id="project_name">
            <%= project.name %>
        </p>
        <button class="features" id="addmember">Add Member</button>
        <button class="features" id="task_management"><img class="logo_but"
                src="https://drive.google.com/uc?export=view&id=1G7SoF3dSO8KJaih2gd-QEQK48ZBjnyIB"
                alt="Task Management">Task Management</button>
        <button class="features" id="file_share"><img class="logo_but"
                src="https://drive.google.com/uc?export=view&id=10ceCs2hQlL0FLKx2Dbbq3WtS3V89jtN0"
                alt="File Sharing">File Sharing</button>
        <button class="features" id="communication"><img class="logo_but"
                src="https://drive.google.com/uc?export=view&id=12WtZqaQCqC0bRVUJaqerilHqOwVdXwvG"
                alt="Communication">Communication</button>
        <button class="features" id="project_analysis"><img class="logo_but"
                src="https://drive.google.com/uc?export=view&id=129D5AI1a6mZ9aiMaw7d-1DnlUhzaaQl0"
                alt="Project Analysis">Task Analysis</button>
        <button id="drop_project_button">Drop Project</button>
        <button id="back_to_prework" onclick="location.href='/pre-workspace'">Back to projects</button>
    </div>

    <div id="task_div_id" class="task_div">
    <p class="roadmap">Roadmap</p>
    <button id="createtask">+ Create task </button>

    <p class="taskready">Task ready</p>
    <p class="inprogress">In Progress</p>
    <p class="needsreview">Needs Review</p>
    <p class="done">Done</p>

    <div class="cont_taskready">
        <% r=0 %>
        <% for (let i = 0; i < tasks.length; i++) { %>     
            <% if(tasks[i].status == "taskready_opt"){ %>
                <% r++ %>
            <div class="task_ejs_div">
                <p class="title_task_in"><%= tasks[i].name %></p>
                <p class="deadline_in"><%= tasks[i].deadline.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                <p class="created_by_in">Created by</p>
                <div id="creator_in"><%= user.name %></div>
                <form action="/workspace/update-task/<%= project._id %>/<%= tasks[i]._id %>" method="post">
                    <select name="status" id="dropdown_taskready">
                        <option value="taskready_opt">Task Ready</option>
                        <option value="inprogress_opt">In Progress</option>
                        <option value="needsreview_opt">Needs Review</option>
                        <option value="done_opt">Done</option>
                    </select>
                    <button id="save_status" type="submit">Save</button>
                </form>
            </div>
            <% } %>
            <% } %> 
    </div>
    <div class="cont_inprogress">
        <% p=0 %>
        <% for (let i = 0; i < tasks.length; i++) { %>     
            <% if(tasks[i].status == "inprogress_opt"){ %>
                <% n++ %>
            <div class="task_ejs_div">
                <p class="title_task_in"><%= tasks[i].name %></p>
                <p class="deadline_in"><%= tasks[i].deadline.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                <p class="created_by_in">Created by</p>
                <div id="creator_in"><%= user.name %></div>
                <form action="/workspace/update-task/<%= project._id %>/<%= tasks[i]._id %>" method="post">
                    <select name="status" id="dropdown_inprogress">
                        <option value="inprogress_opt">In Progress</option>
                        <option value="needsreview_opt">Needs Review</option>
                        <option value="done_opt">Done</option>
                    </select>
                    <button id="save_status" type="submit">Save</button>
                </form>
            </div>
            <% } %>
            <% } %> 
    </div>
    <div class="cont_needsreview">
        <% n=0 %>
        <% for (let i = 0; i < tasks.length; i++) { %>     
            <% if(tasks[i].status == "needsreview_opt"){ %>
                <% n++ %>
            <div class="task_ejs_div">
                <p class="title_task_in"><%= tasks[i].name %></p>
                <p class="deadline_in"><%= tasks[i].deadline.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                <p class="created_by_in">Created by</p>
                <div id="creator_in"><%= user.name %></div>
                <form action="/workspace/update-task/<%= project._id %>/<%= tasks[i]._id %>" method="post">
                    <select name="status" id="dropdown_needsreview">
                        <option value="needsreview_opt">Needs Review</option>
                        <option value="inprogress_opt">In Progress</option>
                        <option value="done_opt">Done</option>
                    </select>
                    <button id="save_status" type="submit">Save</button>
                </form>
            </div>
            <% } %>
            <% } %> 
    </div>
    <div class="cont_done">
        <% d=0 %>
        <% for (let i = 0; i < tasks.length; i++) { %>     
            <% if(tasks[i].status == "done_opt"){ %>
                <% d++ %>
            <div class="task_ejs_div">
                <p class="title_task_in"><%= tasks[i].name %></p>
                <p class="deadline_in"><%= tasks[i].deadline.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                <p class="created_by_in">Created by</p>
                <div id="creator_in"><%= user.name %></div>
                <form action="/workspace/update-task/<%= project._id %>/<%= tasks[i]._id %>" method="post">
                    <select name="status" id="dropdown_done">
                        <option value="done_opt">Done</option>
                        <option value="needsreview_opt">Needs Review</option>
                    </select>
                    <button id="save_status" type="submit">Save</button>
                </form>
            </div>
            <% } %>
            <% } %> 
    </div>
    </div>

    <div id="file_share_div"></div>
    <div id="project_analysis_div">
        <img src="https://drive.google.com/uc?export=view&id=1ljAvSBTtWC5vIt8zQjTu_vZVDAaZlbvs" alt="" id="close_project_analysis">
        <p class="mem_count_project">Members in Projex : </p>
        <p class="count_value_mem">1</p>
        <p class="tasks_completed_p">Total Completed Tasks</p>
        <p class="count_value_completed"><%= d %></p>
        <p class="inprogress_project_analysis">Total tasks that are In Progress : </p>
        <p class="count_value_inprogress"><%= p %></p>
        <p class="review_project_analysis">Total tasks that need to be reviewed : </p>
        <p class="count_value_review"><%= n %></p>
    </div> 

    <form id="create_task_form" method="post" action="/workspace/<%= project._id %>/create-task">
        <input name="taskName" type="none" id="title_task" placeholder="New Task">
        <p class="created_by">Created By</p>
        <div id="creator_of_task"><%= user.name %></div>
        <p class="deadline">Deadline</p>
        <input name="taskDeadline" type="date" id="due_task">
        <button id="create_kar_task">Create Task</button>
        <img src="https://drive.google.com/uc?export=view&id=1ljAvSBTtWC5vIt8zQjTu_vZVDAaZlbvs" alt="" id="close_task_form">
    </form>

    <div id="add_mem">
        <input type="email" id="email" placeholder="Email of member">
        <img src="https://drive.google.com/uc?export=view&id=1JGZA6uKCjA4XAjP3tJKkxImYAePwqlgO" alt="" id="email_img">
        <input type="text" id="role" placeholder="Role : ex. Frontend Developer">
        <img src="https://drive.google.com/uc?export=view&id=19wNPxYbRnEjfeYdWSWkaen7tB7zANsMg" alt="" id="role_img">
        <button id="invite">Invite</button>
        <img src="https://drive.google.com/uc?export=view&id=1ljAvSBTtWC5vIt8zQjTu_vZVDAaZlbvs" alt="" id="close">


        <hr id="tophr">
        <p id="user_label">User</p>
        <p id="role_label">Role</p>
        <hr id="bottomhr">

        <div id="mem_owner">
            <p id="owner_name_add_mem">
                <%= user.name %>
            </p>
            <p id="owner_email_add_mem">
                <%= user.username %>
            </p>
            <p id="owner_role_add_mem"> Creator </p>
        </div>
        <div class="container" id="container"></div>
    </div>

    <form id="delete_window" action="/workspace/<%= project._id %>/delete" method="POST" onsubmit="return confirmDelete()">
            <h class="drop_project">Drop Project</h>
            <p id="type_to_delete">Type "<%= project.name %>" to drop the project</p>
            <input name="projectName" type="text" id="input_type_to_delete" placeholder="Type Here" required
                onkeyup="confirmDelete()">
            <button id="cancel_delete">Cancel</button>
            <button id="drop_project">Drop Project</button>
    </form>

    <script>
        let back = document.getElementById('back')
        let close = document.getElementById('close')
        let invite = document.getElementById('invite')
        let add_mem = document.getElementById('add_mem')
        let addmember = document.getElementById('addmember')
        let task_management = document.getElementById('task_management')
        let delete_window = document.getElementById('delete_window')

        let create_task_form = document.getElementById('create_task_form')
        let taskdiv_id=document.getElementById('task_div_id')
        let file_share_div=document.getElementById('file_share_div')
        let project_analysis_div=document.getElementById('project_analysis_div')

        window.onload = function () {
            document.getElementById("loader").style.display = "none"
            add_mem.style.display = "none"
            delete_window.style.display = "none"
            create_task_form.style.display="none"
            
            file_share_div.style.display="none"
            taskdiv_id.style.display = "flex"
            project_analysis_div.style.display="none"
        }

        window.onunload=function(){
            document.getElementById("loader").style.display = "block"
        }
        addmember.addEventListener("click", function () {
            add_mem.style.display = "inline"
            back.style.background = "rgba(20, 20, 20, 0.507)"
            back.style.zIndex = 1
        })

        close.addEventListener("click", function () {
            add_mem.style.display = "none"
            back.style.background = "none"
            back.style.zIndex = 0
        })
        let i = 1

        invite.addEventListener("click",
            function () {
                if (i >= 5) {
                    alert("you cannot add more members")
                }
                else {
                    const mem_new = document.createElement("div")
                    mem_new.classList.add("mem_new")
                    container.appendChild(mem_new)

                    const mem_new_name = document.createElement('p')
                    mem_new_name.classList.add('mem_new_name')
                    mem_new.appendChild(mem_new_name)
                    mem_new_name.innerHTML = "Alexa Grace"

                    const mem_new_email = document.createElement('p')
                    mem_new_email.classList.add('mem_new_email')
                    mem_new.appendChild(mem_new_email)
                    let mem_new_mailadress = document.getElementById('email').value
                    mem_new_email.innerHTML = mem_new_mailadress

                    const mem_new_role_div = document.createElement('div')
                    mem_new_role_div.classList.add('mem_new_role_div')
                    mem_new.appendChild(mem_new_role_div)

                    const mem_new_role = document.createElement('p')
                    mem_new_role.classList.add('mem_new_role')
                    mem_new_role_div.appendChild(mem_new_role)
                    let mem_new_rolevalue = document.getElementById('role').value
                    mem_new_role.innerHTML = mem_new_rolevalue
                }
                i++
            })

        task_management.addEventListener("click",
        function ()
        {
            file_share_div.style.display="none"
            taskdiv_id.style.display = "flex"
            project_analysis_div.style.display="none"
        })


        let drop = document.getElementById('drop_project_button')
        drop.addEventListener("click",
        function () {
            delete_window.style.display = "flex"
            back.style.background = "rgba(20, 20, 20, 0.507)"
            back.style.zIndex = 1
        })

        let cancel = document.getElementById('cancel_delete')
        cancel.addEventListener("click",
        function () {
            delete_window.style.display = "none"
            back.style.background = "transparent"
            back.style.zIndex = 0
        })

        function confirmDelete() {
            const projectName = '<%= project.name %>';
            const inputName = document.getElementById('input_type_to_delete').value;
            const confirmButton = document.getElementById('drop_project');
            if (projectName === inputName) {
                confirmButton.disabled = false;
                confirmButton.style.color="grey"
                confirmButton.style.borderColor="grey"
                return true;
            } else {
                // alert("The name doesn't match. Please try again.");
                confirmButton.disabled = true;
                confirmButton.style.color="rgb(199, 199, 199)"
                confirmButton.style.borderColor="rgb(199, 199, 199)"
                return false;
            }
        }
        let createtask=document.getElementById('createtask')
        let title_task=document.getElementById('title_task')
        createtask.addEventListener("click", 
        function()
        {
            create_task_form.style.display="flex"
            title_task.focus()
            back.style.background = "rgba(20, 20, 20, 0.507)"
            back.style.zIndex = 1
        })
        let close_task_form=document.getElementById('close_task_form')
        close_task_form.addEventListener("click", 
        function()
        {
            create_task_form.style.display="none"
            back.style.background = "transparent"
            back.style.zIndex = 0
        })

        let file_share=document.getElementById('file_share')
        file_share.addEventListener("click", 
        function()
        {
            file_share_div.style.display="flex"
            taskdiv_id.style.display = "none"
            project_analysis_div.style.display="none"
        })

        let project_analysis=document.getElementById('project_analysis')
        project_analysis.addEventListener("click",
        function()
        {
            file_share_div.style.display="flex"
            taskdiv_id.style.display = "none"
            project_analysis_div.style.display="flex"
            back.style.background = "rgba(20, 20, 20, 0.507)"
            back.style.zIndex = 1
        })

        let close_project_analysis=document.getElementById('close_project_analysis')
        close_project_analysis.addEventListener("click",
        function()
        {
            file_share_div.style.display="flex"
            taskdiv_id.style.display = "none"
            project_analysis_div.style.display="none"
            back.style.background = "transparent"
            back.style.zIndex = 0
        })

    </script>
</body>

</html>